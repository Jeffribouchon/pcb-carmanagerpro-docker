{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Recherche IA Contacts</h2>

  <form method="post" class="mb-3">
    <textarea name="query" class="form-control" placeholder="Décrivez votre besoin..." rows="4"></textarea>
    <button type="submit" class="btn btn-primary mt-2">Chercher</button>
  </form>

  {% if criteria %}
    <h5>Critères extraits par l'IA :</h5>
    <pre>{{ criteria | tojson(indent=2) }}</pre>
  {% endif %}

  {% if results %}
    <h5>Contacts trouvés : {{ results|length }}</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-striped table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Nom</th>
            <th>Email</th>
            <th>Téléphone</th>
            <th>Ville</th>
            <th>Achat par lot</th>
          </tr>
        </thead>
        <tbody>
          {% for contact in results %}
          <tr>
            <td>{{ contact.get("name") }}</td>
            <td>{{ contact.get("email") or "—" }}</td>
            <td>{{ contact.get("phone") or "—" }}</td>
            <td>{{ contact.get("city") or "—" }}</td>
            <td>
              {% if contact.get("x_achat_bulk") %}
                ✅
              {% else %}
                ❌
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% elif criteria %}
    <div class="alert alert-warning mt-3">Aucun contact trouvé.</div>
  {% endif %}
</div>
{% endblock %}
